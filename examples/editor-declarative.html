<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SWT Editor - Declarative Mode</title>
    <link rel="stylesheet" href="../dist/swt-editor.css">
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="../dist/swt.js"></script>
</head>
<body>
    <!-- 
        Declarative Editor Mode
        Uses data-swt-* attributes for automatic initialization
        No JavaScript code required!
    -->
    <div data-swt-editor 
         data-swt-auto-init="true" 
         data-swt-project-name="My Declarative Tour"
         data-swt-auto-save="true"
         data-swt-auto-save-interval="30000">
        
        <!-- Header -->
        <header class="editor-header">
            <div class="header-left">
                <div class="logo">
                    <div class="logo-icon"></div>
                    <span>SWT Editor (Declarative)</span>
                </div>
                <div class="project-info">
                    <span class="project-label">Project:</span>
                    <input type="text" id="project-name" class="project-name" value="My Declarative Tour" 
                           style="background: transparent; border: none; color: var(--text-primary); 
                                  font-size: 14px; font-weight: 500; outline: none;">
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" id="newBtn" title="New Project">New</button>
                <button class="btn btn-secondary" id="importBtn" title="Import JSON">Import</button>
                <button class="btn btn-secondary" id="exportBtn" title="Export JSON">Export</button>
                <button class="btn btn-primary" id="previewBtn" title="Preview Tour">Preview</button>
                <button class="btn btn-success" id="saveBtn" title="Save Project (Ctrl+S)">Save</button>
            </div>
        </header>

        <!-- Main Editor -->
        <main class="editor-main">
            <!-- Scenes Sidebar -->
            <aside class="sidebar" data-swt-scene-list>
                <div class="sidebar-header">
                    <h2 class="sidebar-title">Scenes</h2>
                    <button class="btn-add" id="addSceneBtn">Add Scene</button>
                </div>
                <div class="scenes-list" id="sceneList">
                    <div class="empty-state">
                        <p>No scenes yet</p>
                        <p class="hint">Click "Add Scene" to upload a 360° panorama</p>
                    </div>
                </div>
            </aside>

            <!-- Canvas Area -->
            <div class="canvas-area" id="canvasArea">
                <div class="preview-container">
                    <div class="preview-area" id="preview" data-swt-preview-area>
                        <div class="preview-empty">
                            <p>No scene selected</p>
                            <p>Upload a 360° panorama to start</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Properties Panel -->
            <aside class="properties-panel" data-swt-properties-panel>
                <div class="toolbar">
                    <div class="toolbar-tabs">
                        <button class="tab" data-tab="scene">Scene</button>
                        <button class="tab active" data-tab="hotspot">Hotspot</button>
                        <button class="tab" data-tab="tour">Tour</button>
                    </div>
                </div>

                <div class="panel-content" id="panelContent">
                    <!-- Hotspot Tab Content -->
                    <div class="tab-content active" id="hotspotTab">
                        <div class="section" id="hotspotAll">
                            <div class="hotspot-controls">
                                <button class="btn btn-primary" id="addHotspotBtn">Add Hotspot</button>
                                <button class="btn btn-secondary" id="clearHotspotsBtn">Clear All</button>
                            </div>
                            
                            <div class="hotspot-list" id="hotspotList">
                                <!-- Hotspots will be listed here dynamically -->
                            </div>
                        </div>
                        
                        <div class="section" id="hotspotProperties" style="display: none;">
                            <h3 style="font-size: 14px; margin-bottom: 16px; color: var(--text-secondary);">Hotspot Properties</h3>
                            
                            <div class="form-group">
                                <label class="form-label">Title</label>
                                <input type="text" id="hotspotTitle" class="form-input" placeholder="Hotspot title">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea id="hotspotDescription" class="form-input form-textarea" placeholder="Optional description"></textarea>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Target Scene</label>
                                <select id="hotspotTarget" class="form-select">
                                    <option value="">Select target scene...</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Color</label>
                                <div class="color-picker-group">
                                    <input type="color" id="hotspotColor" class="color-preview" value="#00ff00" 
                                           style="width: 40px; height: 40px; border: 2px solid var(--border-color); 
                                                  border-radius: 6px; cursor: pointer;">
                                    <input type="text" class="form-input color-input" id="hotspotColorText" 
                                           value="#00ff00" placeholder="#00ff00">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Position</label>
                                <div class="position-grid">
                                    <input type="number" id="hotspotPosX" class="form-input position-input" 
                                           step="0.1" placeholder="X">
                                    <input type="number" id="hotspotPosY" class="form-input position-input" 
                                           step="0.1" placeholder="Y">
                                    <input type="number" id="hotspotPosZ" class="form-input position-input" 
                                           step="0.1" placeholder="Z">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Scene Tab Content -->
                    <div class="tab-content" id="sceneTab" style="display: none;">
                        <div class="section">
                            <h3 style="font-size: 14px; margin-bottom: 16px; color: var(--text-secondary);">Scene Properties</h3>
                            
                            <div class="form-group">
                                <label class="form-label">Scene Name</label>
                                <input type="text" id="sceneName" class="form-input" placeholder="Scene name">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Scene ID</label>
                                <input type="text" id="sceneId" class="form-input" placeholder="scene-id" readonly>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Image URL</label>
                                <input type="text" id="sceneImageUrl" class="form-input" 
                                       placeholder="https://example.com/image.jpg">
                                <small style="color: var(--text-muted); margin-top: 4px; display: block; font-size: 11px;">
                                    Enter a URL or keep the uploaded image data URL
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Tour Tab Content -->
                    <div class="tab-content" id="tourTab" style="display: none;">
                        <div class="section">
                            <h3 style="font-size: 14px; margin-bottom: 16px; color: var(--text-secondary);">Tour Settings</h3>
                            
                            <div class="form-group">
                                <label class="form-label">Tour Title</label>
                                <input type="text" id="tourTitle" class="form-input" placeholder="My Virtual Tour">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea id="tourDescription" class="form-input form-textarea" 
                                          placeholder="Tour description"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Initial Scene</label>
                                <select id="tourInitialScene" class="form-select">
                                    <option value="">Select initial scene...</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <div class="form-checkbox">
                                    <input type="checkbox" id="tourAutoRotate">
                                    <label for="tourAutoRotate">Auto-rotate camera</label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <div class="form-checkbox">
                                    <input type="checkbox" id="tourShowCompass">
                                    <label for="tourShowCompass">Show compass</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <!-- Hidden file inputs -->
    <input type="file" id="sceneUpload" accept="image/*" multiple style="display: none">
    <input type="file" id="importUpload" accept=".json" style="display: none">

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Export Modal -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Export Tour</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Your tour is ready to export. Choose an export option:</p>
                <div class="export-info">
                    <p><strong>JSON Only:</strong> Export tour configuration (for use with SWT library)</p>
                    <p><strong>Viewer HTML:</strong> Export standalone HTML viewer with embedded configuration</p>
                </div>
                <textarea id="exportPreview" class="export-preview" readonly></textarea>
            </div>
            <div class="modal-footer">
                <button id="copyJsonBtn" class="btn btn-secondary">Copy JSON</button>
                <button id="exportJsonBtn" class="btn btn-primary">Download JSON</button>
                <button id="exportViewerBtn" class="btn btn-success">Export Viewer HTML</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../dist/swt-editor.js"></script>
    
    <script>
        // Helper function to clear corrupted storage if needed
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('clear') === 'true') {
                localStorage.clear();
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        });
        
        // Add keyboard shortcut for clearing storage: Ctrl+Alt+C
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.altKey && e.key === 'c') {
                if (confirm('Clear all saved data and start fresh?')) {
                    localStorage.clear();
                    location.reload();
                }
            }
        });
    </script>
    
    <!-- 
        Note: The editor now automatically validates and clears corrupted data!
        
        To manually access the editor instance:
        - Editor is available as window.editor
        - console.log('Editor instance:', window.editor);
        
        To clear storage manually:
        - Add ?clear=true to the URL, OR
        - Press Ctrl+Alt+C, OR  
        - Open console and run: localStorage.clear()
        
        Troubleshooting:
        - The editor now automatically detects and clears invalid data
        - If issues persist, try ?clear=true in the URL
        - Check browser console for validation errors
    -->
</body>
</html>
