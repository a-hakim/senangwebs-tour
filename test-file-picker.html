<!DOCTYPE html>
<html>
<head>
    <title>File Picker Test</title>
</head>
<body>
    <h1>File Picker Double-Trigger Test</h1>
    <button id="testBtn">Open File Picker</button>
    <input type="file" id="testUpload" accept="image/*" style="display: none">
    <div id="log" style="margin-top: 20px; font-family: monospace; white-space: pre;"></div>

    <script>
        const log = document.getElementById('log');
        let clickCount = 0;
        let changeCount = 0;
        let listenerSetup = false;

        function addLog(message) {
            log.textContent += `[${new Date().toLocaleTimeString()}] ${message}\n`;
            console.log(message);
        }

        function setupListeners() {
            if (listenerSetup) {
                addLog('⚠️ Listeners already setup, skipping...');
                return;
            }

            addLog('✅ Setting up listeners...');

            document.getElementById('testBtn').addEventListener('click', () => {
                clickCount++;
                addLog(`🖱️ Button clicked (${clickCount})`);
                document.getElementById('testUpload').click();
            });

            document.getElementById('testUpload').addEventListener('change', (e) => {
                changeCount++;
                addLog(`📁 Change event fired (${changeCount}), files: ${e.target.files.length}`);
                if (e.target.files.length > 0) {
                    addLog(`   Selected: ${e.target.files[0].name}`);
                }
                e.target.value = ''; // Reset
            });

            listenerSetup = true;
            addLog('✅ Listeners setup complete');
        }

        // Simulate editor initialization
        addLog('🚀 Page loaded');
        setupListeners();

        // Test: Try to setup listeners again (should be prevented)
        setTimeout(() => {
            addLog('\n🧪 Test: Attempting to setup listeners again...');
            setupListeners();
        }, 1000);
    </script>
</body>
</html>
