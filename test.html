<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SWT - Library Test</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="dist/senangwebs_tour.js"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #0f0;
            padding: 20px;
        }
        h1 { color: #0ff; }
        .test { 
            padding: 10px;
            margin: 10px 0;
            background: #2a2a2a;
            border-left: 4px solid #0f0;
        }
        .test.fail {
            border-left-color: #f00;
            color: #f00;
        }
        .test.pass {
            border-left-color: #0f0;
        }
        #results {
            margin-top: 20px;
            padding: 20px;
            background: #2a2a2a;
            border: 2px solid #0ff;
        }
    </style>
</head>
<body>
    <h1>üß™ SenangWebs Tour Library - Validation Tests</h1>
    <div id="test-output"></div>
    <div id="results"></div>

    <!-- Hidden A-Frame scene for testing -->
    <a-scene id="test-scene" embedded style="width: 1px; height: 1px; position: fixed; top: -9999px;">
        <a-camera></a-camera>
    </a-scene>

    <script>
        const output = document.getElementById('test-output');
        const results = document.getElementById('results');
        let passCount = 0;
        let failCount = 0;

        function log(message, pass = true) {
            const div = document.createElement('div');
            div.className = 'test ' + (pass ? 'pass' : 'fail');
            div.textContent = (pass ? '‚úÖ ' : '‚ùå ') + message;
            output.appendChild(div);
            
            if (pass) passCount++;
            else failCount++;
        }

        function test(description, fn) {
            try {
                const result = fn();
                log(description + ' - ' + (result ? 'PASS' : 'FAIL'), result);
                return result;
            } catch (e) {
                log(description + ' - ERROR: ' + e.message, false);
                return false;
            }
        }

        function showResults() {
            results.innerHTML = `
                <h2>Test Results</h2>
                <p><strong>Total Tests:</strong> ${passCount + failCount}</p>
                <p><strong>Passed:</strong> ${passCount}</p>
                <p><strong>Failed:</strong> ${failCount}</p>
                <p><strong>Success Rate:</strong> ${Math.round((passCount / (passCount + failCount)) * 100)}%</p>
            `;
        }

        // Run tests when A-Frame is ready
        const sceneEl = document.querySelector('#test-scene');
        sceneEl.addEventListener('loaded', () => {
            console.log('Starting SWT Library Tests...');

            // Test 1: Library is loaded
            test('Library is loaded (window.SWT exists)', () => {
                return typeof window.SWT !== 'undefined';
            });

            // Test 2: Tour class is available
            test('SWT.Tour class is available', () => {
                return typeof window.SWT.Tour === 'function';
            });

            // Test 3: A-Frame component is registered
            test('swt-hotspot-listener component is registered', () => {
                return typeof AFRAME !== 'undefined' && 
                       typeof AFRAME.components['swt-hotspot-listener'] !== 'undefined';
            });

            // Test 4: Tour can be instantiated
            let tour;
            test('Tour can be instantiated with valid config', () => {
                const config = {
                    initialScene: "test",
                    scenes: {
                        test: {
                            panorama: "https://cdn.aframe.io/360-image-gallery-boilerplate/img/city.jpg"
                        }
                    }
                };
                tour = new window.SWT.Tour(sceneEl, config);
                return tour !== null && typeof tour === 'object';
            });

            // Test 5: Tour has required methods
            test('Tour has start() method', () => {
                return typeof tour.start === 'function';
            });

            test('Tour has navigateTo() method', () => {
                return typeof tour.navigateTo === 'function';
            });

            test('Tour has getCurrentSceneId() method', () => {
                return typeof tour.getCurrentSceneId === 'function';
            });

            test('Tour has destroy() method', () => {
                return typeof tour.destroy === 'function';
            });

            test('Tour has addEventListener() method', () => {
                return typeof tour.addEventListener === 'function';
            });

            // Test 6: Tour configuration validation
            test('Tour rejects invalid config (no scenes)', () => {
                try {
                    new window.SWT.Tour(sceneEl, { initialScene: "test" });
                    return false;
                } catch (e) {
                    return true;
                }
            });

            test('Tour rejects invalid config (no initialScene)', () => {
                try {
                    new window.SWT.Tour(sceneEl, { scenes: {} });
                    return false;
                } catch (e) {
                    return true;
                }
            });

            // Test 7: Event system
            test('Tour event system works', () => {
                let eventFired = false;
                const testTour = new window.SWT.Tour(sceneEl, {
                    initialScene: "test",
                    scenes: {
                        test: { panorama: "test.jpg" }
                    }
                });
                
                testTour.addEventListener('test-event', () => {
                    eventFired = true;
                });
                
                testTour.emit('test-event');
                return eventFired;
            });

            // Test 8: Tour can start
            test('Tour can start successfully', async () => {
                const testConfig = {
                    initialScene: "scene1",
                    scenes: {
                        scene1: {
                            panorama: "https://cdn.aframe.io/360-image-gallery-boilerplate/img/city.jpg",
                            hotspots: []
                        }
                    }
                };
                
                const testTour = new window.SWT.Tour(sceneEl, testConfig);
                
                try {
                    await testTour.start();
                    const currentScene = testTour.getCurrentSceneId();
                    testTour.destroy();
                    return currentScene === 'scene1';
                } catch (e) {
                    console.error('Start failed:', e);
                    return false;
                }
            });

            // Test 9: Scene manager exists
            test('Tour has SceneManager', () => {
                const testTour = new window.SWT.Tour(sceneEl, {
                    initialScene: "test",
                    scenes: { test: { panorama: "test.jpg" } }
                });
                return testTour.sceneManager !== undefined;
            });

            // Test 10: Hotspot manager exists
            test('Tour has HotspotManager', () => {
                const testTour = new window.SWT.Tour(sceneEl, {
                    initialScene: "test",
                    scenes: { test: { panorama: "test.jpg" } }
                });
                return testTour.hotspotManager !== undefined;
            });

            // Test 11: Asset manager exists
            test('Tour has AssetManager', () => {
                const testTour = new window.SWT.Tour(sceneEl, {
                    initialScene: "test",
                    scenes: { test: { panorama: "test.jpg" } }
                });
                return testTour.assetManager !== undefined;
            });

            // Show final results
            setTimeout(() => {
                showResults();
                console.log(`Tests complete: ${passCount} passed, ${failCount} failed`);
            }, 1000);
        });
    </script>
</body>
</html>
